<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="CRiSp">
<title>Corridor delineation • CRiSp</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Corridor delineation">
<meta property="og:description" content="CRiSp">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">CRiSp</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/corridor-delineation.html">Corridor delineation</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/CityRiverSpaces/crisp/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Corridor delineation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/CityRiverSpaces/crisp/blob/HEAD/vignettes/corridor-delineation.Rmd" class="external-link"><code>vignettes/corridor-delineation.Rmd</code></a></small>
      <div class="d-none name"><code>corridor-delineation.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cityriverspaces.github.io/CRiSp/">CRiSp</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.10.2, GDAL 3.4.1, PROJ 8.2.1; sf_use_s2() is TRUE</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span></code></pre></div>
<p>In this notebook we explore how to delineate a river corridor using
Bucharest as the study area. We focus on one of the rivers and use a
specific projected CRS for the analysis. Also, we make sure that we
include a given area around the city boundaries.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">city_name</span> <span class="op">&lt;-</span> <span class="st">"Bucharest, Romania"</span>   <span class="co"># Be specific and spell as it appears in OSM</span></span>
<span><span class="va">river_name</span> <span class="op">&lt;-</span> <span class="st">"Dâmbovița"</span>           <span class="co"># Spell as it appears in OpenStreetMap</span></span>
<span><span class="va">epsg_code</span> <span class="op">&lt;-</span> <span class="fl">32635</span>                  <span class="co"># UTM zone 35N</span></span>
<span><span class="va">bbox_buffer</span> <span class="op">&lt;-</span> <span class="fl">2000</span>                 <span class="co"># Buffer around the city boundary in meters</span></span></code></pre></div>
<div class="section level2">
<h2 id="setting-the-area-of-interest">Setting the area of interest<a class="anchor" aria-label="anchor" href="#setting-the-area-of-interest"></a>
</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get the bounding box from the Nominatim API provided by OSM.</span></span>
<span><span class="va">bb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/osm_bb.html">osm_bb</a></span><span class="op">(</span><span class="va">city_name</span><span class="op">)</span></span>
<span></span>
<span><span class="va">aoi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_aoi.html">define_aoi</a></span><span class="op">(</span><span class="va">bb</span>, <span class="va">epsg_code</span>, <span class="va">bbox_buffer</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">city_boundary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/osmdata_as_sf.html">osmdata_as_sf</a></span><span class="op">(</span><span class="st">"place"</span>, <span class="st">"city"</span>, <span class="va">bb</span><span class="op">)</span><span class="op">$</span><span class="va">osm_multipolygons</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">epsg_code</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="constructing-the-initial-corridor">Constructing the initial corridor<a class="anchor" aria-label="anchor" href="#constructing-the-initial-corridor"></a>
</h2>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">river_centerline</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/osmdata_as_sf.html">osmdata_as_sf</a></span><span class="op">(</span><span class="st">"waterway"</span>, <span class="st">"river"</span>, <span class="va">bb</span><span class="op">)</span><span class="op">$</span><span class="va">osm_multilines</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="va">river_name</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">epsg_code</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html" class="external-link">st_intersection</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_buffer</a></span><span class="op">(</span><span class="va">aoi</span>, <span class="va">bbox_buffer</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">river_surface</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/osmdata_as_sf.html">osmdata_as_sf</a></span><span class="op">(</span><span class="st">"natural"</span>, <span class="st">"water"</span>, <span class="va">bb</span><span class="op">)</span></span>
<span><span class="va">river_surface</span> <span class="op">&lt;-</span> <span class="va">river_surface</span><span class="op">$</span><span class="va">osm_multipolygons</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">river_surface</span><span class="op">$</span><span class="va">osm_polygons</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">epsg_code</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html" class="external-link">st_filter</a></span><span class="op">(</span><span class="va">river_centerline</span>, .predicate <span class="op">=</span> <span class="va">st_intersects</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html" class="external-link">st_union</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>With these features we can now delineate a theoretical river corridor
representing the maximum area from which the river could be reached
within a walking distance. We construct the initial corridor from the
merged geometries of <code>river_centerline</code> and
<code>river_surface</code>, with a buffer of 500m around them:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">corridor_buffer</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">corridor_initial</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">river_centerline</span>, <span class="va">river_surface</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_buffer</a></span><span class="op">(</span><span class="va">corridor_buffer</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html" class="external-link">st_union</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>We can now plot the initial corridor:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">city_boundary</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">corridor_initial</span>,</span>
<span>     border <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Initial river corridor"</span>,</span>
<span>     add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="corridor-delineation_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="getting-the-street-network">Getting the street network<a class="anchor" aria-label="anchor" href="#getting-the-street-network"></a>
</h2>
<p>Querying the Overpass API for the <code>highway</code> key:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">highway_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"motorway"</span>, <span class="st">"primary"</span>, <span class="st">"secondary"</span>, <span class="st">"tertiary"</span><span class="op">)</span></span>
<span><span class="va">streets</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/osmdata_as_sf.html">osmdata_as_sf</a></span><span class="op">(</span><span class="st">"highway"</span>, <span class="va">highway_values</span>, <span class="va">bb</span><span class="op">)</span></span>
<span><span class="va">streets</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge_streets.html">merge_streets</a></span><span class="op">(</span><span class="va">streets</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="st">"highway"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in st_cast.sf(highways$osm_polygons, "LINESTRING"): repeating</span></span>
<span><span class="co">#&gt; attributes for all sub-geometries for which they may not be constant</span></span></code></pre></div>
<p>We split the area of interest in two parts using the river centreline
as separator. The two areas can then be used to split the network in two
as a preparation to the shortest path algorithm used for edge
delineation in the next step:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aoi_split</span> <span class="op">&lt;-</span> <span class="va">aoi</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/split_aoi.html">split_aoi</a></span><span class="op">(</span><span class="va">river_centerline</span><span class="op">)</span></span>
<span></span>
<span><span class="va">net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_network.html">create_network</a></span><span class="op">(</span><span class="va">streets</span>, <span class="va">epsg_code</span><span class="op">)</span></span>
<span></span>
<span><span class="va">net_1</span> <span class="op">&lt;-</span> <span class="va">net</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/trim_network.html">trim_network</a></span><span class="op">(</span><span class="va">aoi_split</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">corridor_initial</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/clean_network.html">clean_network</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/calc_weights.html">calc_weights</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">sfnetworks</span><span class="fu">::</span><span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html" class="external-link">activate</a></span><span class="op">(</span><span class="st">"nodes"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">tidygraph</span><span class="fu">::</span><span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/group_graph.html" class="external-link">group_components</a></span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: to_spatial_subdivision assumes attributes are constant over geometries</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">net_2</span> <span class="op">&lt;-</span> <span class="va">net</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/trim_network.html">trim_network</a></span><span class="op">(</span><span class="va">aoi_split</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">corridor_initial</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/clean_network.html">clean_network</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/calc_weights.html">calc_weights</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">sfnetworks</span><span class="fu">::</span><span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html" class="external-link">activate</a></span><span class="op">(</span><span class="st">"nodes"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">tidygraph</span><span class="fu">::</span><span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/group_graph.html" class="external-link">group_components</a></span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: to_spatial_subdivision assumes attributes are constant over geometries</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="corridor-edge-delineation">Corridor edge delineation<a class="anchor" aria-label="anchor" href="#corridor-edge-delineation"></a>
</h2>
<p>Determine the “vertices” of the initial river corridor as the
intersections of the initial river corridor with the AoI boundary. We
will use these points as extremes for the corridor edges:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vertices_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_vertices.html">get_vertices</a></span><span class="op">(</span><span class="va">aoi_split</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">corridor_initial</span> <span class="op">|&gt;</span></span>
<span>                             <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html" class="external-link">st_cast</a></span><span class="op">(</span><span class="st">"LINESTRING"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">vertices_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_vertices.html">get_vertices</a></span><span class="op">(</span><span class="va">aoi_split</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">corridor_initial</span> <span class="op">|&gt;</span></span>
<span>                             <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html" class="external-link">st_cast</a></span><span class="op">(</span><span class="st">"LINESTRING"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">corridor_edge_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_corridor_edge.html">get_corridor_edge</a></span><span class="op">(</span><span class="va">net_1</span>, <span class="va">aoi_split</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">vertices_1</span><span class="op">)</span></span>
<span><span class="va">corridor_edge_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_corridor_edge.html">get_corridor_edge</a></span><span class="op">(</span><span class="va">net_2</span>, <span class="va">aoi_split</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">vertices_2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">corridor_edges</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html" class="external-link">st_union</a></span><span class="op">(</span><span class="va">corridor_edge_1</span>, <span class="va">corridor_edge_2</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="capping-the-corridor">Capping the corridor<a class="anchor" aria-label="anchor" href="#capping-the-corridor"></a>
</h2>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">capped_corridor</span> <span class="op">&lt;-</span> <span class="va">city_boundary</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">lwgeom</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/lwgeom/reference/st_split.html" class="external-link">st_split</a></span><span class="op">(</span><span class="va">corridor_edges</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_collection_extract.html" class="external-link">st_collection_extract</a></span><span class="op">(</span><span class="st">"POLYGON"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html" class="external-link">st_filter</a></span><span class="op">(</span><span class="va">river_centerline</span>, .predicate <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="va"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html" class="external-link">st_intersects</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># TODO replace with call to cap_corridor()</span></span>
<span><span class="va">corridor</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cap_corridor.html">cap_corridor</a></span><span class="op">(</span><span class="va">corridor_edges</span>, <span class="va">river_centerline</span>, <span class="va">epsg_code</span>, <span class="va">bb</span><span class="op">)</span></span></code></pre></div>
<p>Note that this is not ideal, as the municipal boundaries can be
arbitrary and might exclude important end features of the corridors, so
the user should have the option to input their own feature to cap the
corridor ends. In the case of Bucharest, this can be the ring road.</p>
</div>
<div class="section level2">
<h2 id="all-in-one-step">All in one step<a class="anchor" aria-label="anchor" href="#all-in-one-step"></a>
</h2>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># TODO this function should run the entire delineation process</span></span>
<span><span class="fu"><a href="../reference/delineate_corridor.html">delineate_corridor</a></span><span class="op">(</span><span class="va">city_name</span>, <span class="va">river_name</span>, <span class="va">epsg_code</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Claudiu Forgaci, Francesco Nattino, Netherlands eScience Center.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
