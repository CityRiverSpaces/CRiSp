<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>5. Multiple cities • CRiSp</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="5. Multiple cities">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">CRiSp</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/method.html">1. The method</a></li>
    <li><a class="dropdown-item" href="../articles/corridor-delineation.html">2. Corridor delineation</a></li>
    <li><a class="dropdown-item" href="../articles/corridor-segmentation.html">3. Corridor segmentation</a></li>
    <li><a class="dropdown-item" href="../articles/riverspace-delineation.html">4. Riverspace delineation</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Use cases</h6></li>
    <li><a class="dropdown-item" href="../articles/multiple-cities.html">5. Multiple delineations</a></li>
    <li><a class="dropdown-item" href="../articles/poi-study-area.html">6. Study area around a POI</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/CityRiverSpaces/crisp/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>5. Multiple cities</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/CityRiverSpaces/crisp/blob/main/vignettes/multiple-cities.Rmd" class="external-link"><code>vignettes/multiple-cities.Rmd</code></a></small>
      <div class="d-none name"><code>multiple-cities.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cityriverspaces.github.io/CRiSp/">CRiSp</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="motivation">Motivation<a class="anchor" aria-label="anchor" href="#motivation"></a>
</h2>
<p>Comparative analysis can shed light on patterns that are not visible
in a single case. The automated delineation provided by CRiSp allows for
a reliable frame of reference for such comparisons, including:</p>
<ol style="list-style-type: decimal">
<li>all cities along a large river;</li>
<li>all river-crossed cities of a given size;</li>
<li>all cities crossed by rivers of the same kind in a given
region.</li>
</ol>
<p>We can use the <code><a href="../reference/delineate_corridor.html">delineate_corridor()</a></code> function repeatedly
to extract data for multiple cities and rivers, and subsequently compare
them. This vignette demonstrates how to perform such an analysis using
CRiSp.</p>
</div>
<div class="section level2">
<h2 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h2>
<p>We focus on the following five cities and rivers:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cities</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Bucharest, Romania"</span>, <span class="st">"Vienna, Austria"</span>, <span class="st">"Paris, France"</span>,</span>
<span>            <span class="st">"London, United Kingdom"</span>, <span class="st">"Berlin, Germany"</span><span class="op">)</span></span>
<span><span class="va">rivers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Dâmbovița"</span>, <span class="st">"Wienfluss"</span>, <span class="st">"Seine"</span>, <span class="st">"Thames"</span>, <span class="st">"Spree"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="delineation">Delineation<a class="anchor" aria-label="anchor" href="#delineation"></a>
</h2>
<p>We can use the <code>map2()</code> function form the
<code>purrr</code> package to iterate over the cities and rivers and
extract their corridor boundaries. We can skip parts of the delineation
by passing the respective parameters to the <code>purrrr::map2()</code>
function. We skip riverspace delineation in this case
(i.e. <code>riverspace = FALSE</code>). The result is a list of
delineated corridors.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">corridors</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2</a></span><span class="op">(</span><span class="va">cities</span>, <span class="va">rivers</span>, <span class="va">delineate_corridor</span>, riverspace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">corridors</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="validation">Validation<a class="anchor" aria-label="anchor" href="#validation"></a>
</h2>
<p>We can validate the results either by plotting the corridors of each
city or by checking if the delineation resulted in any empty geometries.
While the former can be a quick way to validate a small number of
cities, the latter is better suited for a larger number of cases and
requires automated tests that identify the exact causes of missing
geometries.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">corridors</span>, <span class="op">~</span> <span class="va">.x</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_query.html" class="external-link">st_is_empty</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="parallelisation">Parallelisation<a class="anchor" aria-label="anchor" href="#parallelisation"></a>
</h2>
<p>Analysing multiple cities with CRiSp in this fashion can quickly
become computationally expensive. However, as the analysis required for
each city is independent of that of the other cities, we can improve the
wall-time of the computation (i.e. the time we must wait for our
results), by using the <code>furrr</code> package to map and execute the
analysis functions for each city in parallel.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">future</span><span class="fu">::</span><span class="fu">plan</span><span class="op">(</span><span class="va">multisession</span><span class="op">)</span></span>
<span><span class="va">corridors</span> <span class="op">&lt;-</span> <span class="fu">furrr</span><span class="fu">::</span><span class="fu">future_map2</span><span class="op">(</span><span class="va">cities</span>, <span class="va">rivers</span>, <span class="va">delineate_corridor</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Claudiu Forgaci, Francesco Nattino, Netherlands eScience Center.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
